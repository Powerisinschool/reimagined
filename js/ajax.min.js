var next="";const alertUserError=function(msg){$("#modalBody").text(msg),$("#errorModal").modal("show")},getMsg=function(){url="/messages/get",type="POST";var name="chatter",value=JSON.parse("<%- JSON.stringify(username) %>");data[name]=value,$.ajax({type:type,url:url,dataType:JSON,data:data,success:function(res){if(console.log(res),"messages"==res.id){const messagerec=message=>`\n                        <div class="message">\n                            <a class="avatar avatar-sm mr-4 mr-lg-5" href="#" data-chat-sidebar-toggle="#chat-2-info">\n                                <img class="avatar-img" src="assets/images/avatars/10.jpg" alt="">\n                            </a>\n                            <div class="message-body">\n                                <div class="message-row">\n                                    <div class="d-flex align-items-center">\n                                        <div class="message-content bg-light">\n                                            <h6 class="mb-2"><%- JSON.stringify(userfirstname) %> <%- JSON.stringify(userlastname) %></h6>\n                                            <div>\n                                                ${message}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    `,messagesent=message=>`\n                        <div class="message">\n                            <a class="avatar avatar-sm mr-4 mr-lg-5" href="#" data-chat-sidebar-toggle="#chat-2-info">\n                                <img class="avatar-img" src="assets/images/avatars/10.jpg" alt="">\n                            </a>\n                            <div class="message-body">\n                                <div class="message-row">\n                                    <div class="d-flex align-items-center">\n                                        <div class="message-content bg-light">\n                                            <h6 class="mb-2"><%- JSON.stringify(userfirstname) %> <%- JSON.stringify(userlastname) %></h6>\n                                            <div>\n                                                ${message}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    `;var results=res.content,container=$("#chatcon"),messages="";if(results){for(result in results)"<%- JSON.stringify(username) %>"==result.sender?messages+=messagerec(result.message):(messages+=messagesent(result.message),console.log(result.message));container.html(messages)}}}})},find=function(){var findForm=$("#searcher");url=findForm.attr("action"),type=findForm.attr("method"),findForm.trigger(()=>{findForm.find("[name]").each((function(){var that=$(this),name=that.attr("name"),value=that.val();data[name]=value})),$.ajax({type:type,url:url,dataType:JSON,data:data,success:function(res){"exist"==res.id&&(window.location.href=`/chat/${$("#searcher").val()}`)}})})},login=function(event){var logForm=$("#loginform");$("input").attr("disabled",!0),$("#meprog").css("display","flex"),$("#loginProgress").css("display","block"),$("#loginProgress").css("width","25%"),url=logForm.attr("action"),type=logForm.attr("method"),data={},$("#loginProgress").css("width","50%"),logForm.find("[name]").each((function(){var that=$(this),name=that.attr("name"),value=that.val();data[name]=value})),$("#loginProgress").css("width","75%"),$.ajax({type:type,url:url,dataType:"JSON",data:data,success:function(response){if($("#loginProgress").css("width","100%"),setTimeout(()=>{$("#loginProgress").css("width","0%"),$("#meprog").css("display","none"),$("input").removeAttr("disabled")},2e3),"detailerror"==response.id)alertUserError(response.content);else if("empty"==response.id)alertUserError(response.content);else if("success"==response.id){alertUserError("Logged In");var go=$("#continue").val();setTimeout(()=>{go?window.location.replace(`${go}`):window.location.replace("/messages")},3e3)}else"sqlerror"==response.id?alertUserError(response.content):"usernamefound"==response.id?alertUserError(response.content):(response.id,alertUserError(response.content));$("input").removeAttr("disabled")},error:function(xhr,status,error){$("#loginProgress").css("width","99%"),setTimeout(()=>{$("#loginProgress").css("width","0%"),$("#meprog").css("display","none");var errorMessage=xhr.status+": "+xhr.statusText;alertUserError("Error - "+errorMessage),$("input").removeAttr("disabled")},2e3)}}),event.preventDefault(),event.stopPropagation()},register=function(event){var regForm=$("#registerform");$("input").attr("disabled",!0),$("button").attr("disabled",!0),url=regForm.attr("action"),type=regForm.attr("method"),data={},regForm.find("[name]").each((function(){var that=$(this),name=that.attr("name"),value=that.val();data[name]=value})),$.ajax({type:type,url:url,dataType:"JSON",data:data,success:function(response){"empty"==response.id?console.log("Empty Fields"):"success"==response.id?($("body").html("Redirecting you to login"),console.log("Account Created. Time for you to login"),setTimeout(()=>{window.location.replace(`/login?next=${next}`)},3e3)):"sqlerror"==response.id?(console.log(response.content),console.log("For some reason I could not insert into the database")):"usernamefound"==response.id?console.log(response.content):"emailfound"==response.id?console.log(response.content):console.log("There was a serious error in this Ajax Whatever even though I received response"),$("input").removeAttr("disabled"),$("button").removeAttr("disabled")}}),event.preventDefault(),event.stopPropagation()};function isEmpty(el){return!$.trim(el.html())}